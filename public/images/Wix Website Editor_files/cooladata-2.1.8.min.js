(function(g){function m(){m.done||(x=m.done=!0,y=!1,c.each(n,function(a){a._dom_loaded()}))}var t=[],p=Array.prototype,o=Object.prototype,z=p.slice,u=o.toString,v=o.hasOwnProperty,k=window.console,w=window.navigator,f=window.document,r=w.userAgent,A="https:"==f.location.protocol?"https://":"http://",o=g&&g.__SV||0,B=window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,y=!B&&-1==r.indexOf("MSIE")&&-1==r.indexOf("Mozilla"),c={},H={api_host:A+"api.cooladata.com",loaded:function(){},img:!1,http_post:!1,
track_pageload:!1,cookie_expiration:365,disable_cookie:!1,cookie_name:"cd_user_id"},x=!1,C=p.forEach,p=Array.isArray,D={},E=c.each=function(a,b,h){if(null!=a)if(C&&a.forEach===C)a.forEach(b,h);else if(a.length===+a.length)for(var e=0,c=a.length;e<c&&!(e in a&&b.call(h,a[e],e,a)===D);e++);else for(e in a)if(v.call(a,e)&&b.call(h,a[e],e,a)===D)break};c.extend=function(a){E(z.call(arguments,1),function(b){for(var h in b)void 0!==b[h]&&(a[h]=b[h])});return a};c.isArray=p||function(a){return"[object Array]"===
u.call(a)};c.isFunction=function(a){try{return/^\s*\bfunction\b/.test(a)}catch(b){return!1}};c.isArguments=function(a){return!(!a||!v.call(a,"callee"))};c.toArray=function(a){return!a?[]:a.toArray?a.toArray():c.isArray(a)||c.isArguments(a)?z.call(a):c.values(a)};c.values=function(a){var b=[];if(null==a)return b;E(a,function(a){b[b.length]=a});return b};c.isObject=function(a){return a===Object(a)&&!c.isArray(a)};c.isUndefined=function(a){return void 0===a};c.isString=function(a){return"[object String]"==
u.call(a)};c.JSONEncode=function(a){var b=function(a){var b=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};b.lastIndex=0;return b.test(a)?'"'+a.replace(b,function(a){var b=h[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'},h=function(a,c){var i="",d=0,f=d="",f=0,g=i,l=[],j=c[a];j&&("object"===
typeof j&&"function"===typeof j.toJSON)&&(j=j.toJSON(a));switch(typeof j){case "string":return b(j);case "number":return isFinite(j)?String(j):"null";case "boolean":case "null":return String(j);case "object":if(!j)return"null";i+="    ";l=[];if("[object Array]"===u.apply(j)){f=j.length;for(d=0;d<f;d+=1)l[d]=h(d,j)||"null";return f=0===l.length?"[]":i?"[\n"+i+l.join(",\n"+i)+"\n"+g+"]":"["+l.join(",")+"]"}for(d in j)v.call(j,d)&&(f=h(d,j))&&l.push(b(d)+(i?": ":":")+f);return f=0===l.length?"{}":i?
"{"+l.join(",")+""+g+"}":"{"+l.join(",")+"}"}};return h("",{"":a})};c.strip_empty_properties=function(a){var b={};c.each(a,function(a,e){c.isString(a)&&0<a.length&&(b[e]=a)});return b};c.base64Encode=function(a){var b={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){for(var c="",d,i,f,g,k,l,j=0,a=b._utf8_encode(a);j<a.length;)d=a.charCodeAt(j++),i=a.charCodeAt(j++),f=a.charCodeAt(j++),g=d>>2,d=(d&3)<<4|i>>4,k=(i&15)<<2|f>>6,l=f&63,isNaN(i)?k=l=64:isNaN(f)&&
(l=64),c=c+this._keyStr.charAt(g)+this._keyStr.charAt(d)+this._keyStr.charAt(k)+this._keyStr.charAt(l);return c},_utf8_encode:function(a){for(var a=a.replace(/\r\n/g,"\n"),b="",c=0;c<a.length;c++){var i=a.charCodeAt(c);128>i?b+=String.fromCharCode(i):(127<i&&2048>i?b+=String.fromCharCode(i>>6|192):(b+=String.fromCharCode(i>>12|224),b+=String.fromCharCode(i>>6&63|128)),b+=String.fromCharCode(i&63|128))}return b}};return b.encode(a)};c.utf8Encode=function(a){for(var a=a.replace(/\r\n/g,"\n"),b="",c=
0;c<a.length;c++){var e=a.charCodeAt(c);128>e?b+=String.fromCharCode(e):(127<e&&2048>e?b+=String.fromCharCode(e>>6|192):(b+=String.fromCharCode(e>>12|224),b+=String.fromCharCode(e>>6&63|128)),b+=String.fromCharCode(e&63|128))}return b};c.HTTPBuildQuery=function(a,b){var h,e,d=[];"undefined"===typeof b&&(b="&");c.each(a,function(a,b){h=encodeURIComponent(a.toString());e=encodeURIComponent(b);d[d.length]=e+"="+h});return d.join(b)};var F=function(){for(var a=1*new Date,b=0;a==1*new Date;)b++;return a.toString(16)+
b.toString(16)};c.UUID=function(){var a=(screen.height*screen.width).toString(16),b=F()+"-"+Math.random().toString(16).replace(".","")+"-",c;c=function(a,b){var c,h=0;for(c=0;c<b.length;c++)h|=i[c]<<8*c;return a^h};var e,d,i=[],f=0;for(e=0;e<r.length;e++)d=r.charCodeAt(e),i.unshift(d&255),4<=i.length&&(f=c(f,i),i=[]);0<i.length&&(f=c(f,i));c=f.toString(16);return b+c+"-"+a+"-"+F()};c.getQueryParam=function(a,b){var b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),c=RegExp("[\\?&]"+b+"=([^&#]*)").exec(a);
return null===c||c&&"string"!==typeof c[1]&&c[1].length?"":decodeURIComponent(c[1]).replace(/\+/g," ")};var q=function(a){a&&(a.preventDefault=q.preventDefault,a.stopPropagation=q.stopPropagation);return a};q.preventDefault=function(){this.returnValue=!1};q.stopPropagation=function(){this.cancelBubble=!0};c.register_event=function(a,b,h,e){if(a)if(a.addEventListener&&!e)a.addEventListener(b,h,!1);else{var b="on"+b,d=a[b];a[b]=function(b){if(b=b||q(window.event)){var e=!0,f;c.isFunction(d)&&(f=d(b));
b=h.call(a,b);if(!1===f||!1===b)e=!1;return e}}}else k.log("No valid element provided to register_event")};c.info={campaignParams:function(){var a="",b={};c.each(["utm_source","utm_medium","utm_campaign","utm_content","utm_term"],function(h){a=c.getQueryParam(f.URL,h);a.length&&(b[h]=a)});return b},referringDomain:function(a){a=a.split("/");return 3<=a.length?a[2]:""},properties:function(){return c.extend(c.strip_empty_properties({session_screen_size:window.screen.width+"x"+window.screen.height,session_dua:w.userAgent,
session_platform:w.platform,referring_url:f.referrer,referring_domain:c.info.referringDomain(f.referrer)}),{tracker_type:"javascript",tracker_version:"2.1.7"})},pageviewInfo:function(){return c.strip_empty_properties({event_timestamp_epoch:1*new Date,page_url:window.location.protocol+"//"+window.location.host+window.location.pathname,page_title:f.title})}};var p={critical:function(){if(!c.isUndefined(k)&&k){var a=["Cooladata error:"].concat(c.toArray(arguments));try{k.error.apply(k,a)}catch(b){c.each(a,
function(a){k.error(a)})}}}},s=function(a,b,h){var e,f="cooladata"===h?g:g[h];if(f&&!c.isArray(f))k.log("You have already initialized "+h);else return e=new d,e._init(a,b,h),c.isUndefined(f)||e._execute_array(f),e},d=function(){};d.prototype.init=function(a,b,c){if("undefined"===typeof c)k.log("You must name your new library: init(token, config, name)");else if("cooladata"===c)k.log("You must initialize the main cooladata object right after you include the Cooladata js snippet");else return a=s(a,
b,c),g[c]=a,a._loaded(),a};d.prototype._init=function(a){this.__loaded=!0;this.config={};this.set_config(c.extend({},H,{token:a.app_key,img:a.img_src_get_request,session_id:a.session_id,http_post:a.http_post,track_pageload:a.track_pageload,disable_cookie:a.disable_cookie}));a.api_host&&this.set_config({api_host:A+a.api_host});if(a.user_id)this.set_config({user_id:a.user_id});else if(this.get_config("disable_cookie"))this.set_config({user_id:c.UUID()});else{var a=this.get_config("cookie_name"),b=this.getCookie(a);
""==b?(this.setCookie(a),b=this.getCookie(a),""==b?this.set_config({user_id:c.UUID()}):this.set_config({user_id:b})):this.set_config({user_id:b})}this.__dom_loaded_queue=[];this.__request_queue=[]};d.prototype.getCookie=function(a){for(var a=a+"=",b=f.cookie.split(";"),c=0;c<b.length;c++){for(var e=b[c];" "==e.charAt(0);)e=e.substring(1);if(0==e.indexOf(a))return e.substring(a.length,e.length)}return""};d.prototype.setCookie=function(a){var b=this.get_config("cookie_expiration"),h=new Date;h.setTime(h.getTime()+
864E5*b);b="; expires="+h.toGMTString();f.cookie=a+"="+c.UUID()+b};d.prototype._loaded=function(){this.get_config("loaded")(this);this.get_config("track_pageload")&&this.track_pageload()};d.prototype._dom_loaded=function(){c.each(this.__dom_loaded_queue,function(a){this._track_dom.apply(this,a)},this);c.each(this.__request_queue,function(a){this._send_request.apply(this,a)},this);delete this.__dom_loaded_queue;delete this.__request_queue};d.prototype._track_dom=function(a,b){if(this.get_config("img"))return k.log("You can't use DOM tracking functions with img = true."),
!1;if(!x)return this.__dom_loaded_queue.push([a,b]),!1;var c=(new a).init(this);return c.track.apply(c,b)};d.prototype.trackEventLater=function(a,b){if("undefined"===typeof a)k.log("No event name provided to cooladata.trackEventLater");else{var b=b||{},d=new Date,d=c.extend({},c.info.properties(),c.info.campaignParams(),{event_name:a,event_timestamp_epoch:d.getTime().toString(),event_timezone_offset:-1*(d.getTimezoneOffset()/60),user_id:this.get_config("user_id"),session_id:this.get_config("session_id")}),
d=c.extend(d,b);t.push(d)}};d.prototype.flush=function(){var a=this.get_config("api_host")+"/v1/"+this.get_config("token")+"/track",b=c.JSONEncode({events:t});this._send_request(a,b);t=[]};d.prototype._send_request=function(a,b,d){if(y)this.__request_queue.push(arguments);else{var e=window.navigator.userAgent;if(-1<e.indexOf("MSIE ")&&1!==e.split("MSIE ")[1].charAt(0)||this.get_config("img"))b={data:c.base64Encode(b)},a+="?"+c.HTTPBuildQuery(b),e=f.createElement("img"),e.src=a,e.setAttribute("onerror",
'this.style.width="0";this.style.height="0"'),f.body.appendChild(e);else if(B){e=null;this.get_config("http_post")?e="data="+b:(b={data:c.base64Encode(b)},a+="?"+c.HTTPBuildQuery(b));var g=new XMLHttpRequest;this.get_config("http_post")?(g.open("POST",a,!0),g.setRequestHeader("Content-type","application/x-www-form-urlencoded")):g.open("GET",a,!0);g.withCredentials=!0;g.onreadystatechange=function(){4===g.readyState&&(200===g.status?d&&d():k.log("Bad HTTP status: "+g.status+" "+g.statusText))};g.send(e)}else{e=
f.createElement("script");e.type="text/javascript";e.async=!0;e.defer=!0;e.src=a;var i=f.getElementsByTagName("script")[0];i.parentNode.insertBefore(e,i)}}};d.prototype._execute_array=function(a){var b,d=[],e=[],f=[];c.each(a,function(a){a&&(b=a[0],"function"===typeof a?a.call(this):c.isArray(a)&&"alias"===b?d.push(a):c.isArray(a)&&-1!=b.indexOf("track")&&"function"===typeof this[b]?f.push(a):e.push(a))},this);a=function(a,b){c.each(a,function(a){this[a[0]].apply(this,a.slice(1))},b)};a(d,this);a(e,
this);a(f,this)};d.prototype.push=function(a){this._execute_array([a])};d.prototype.trackEvent=function(a,b,d){if("undefined"===typeof a)k.log("No event name provided to cooladata.trackEvent");else{var b=b||{},e=new Date,a=c.extend({},c.info.properties(),c.info.campaignParams(),{event_name:a,event_timestamp_epoch:e.getTime().toString(),event_timezone_offset:-1*(e.getTimezoneOffset()/60),user_id:this.get_config("user_id"),session_id:this.get_config("session_id")}),a=c.extend(a,b),a={events:[a]},b=
c.JSONEncode(a),a=this.get_config("api_host")+"/v1/"+this.get_config("token")+"/track";this._send_request(a,b,d)}};d.prototype.track_pageload=function(a){"undefined"===typeof a&&(a=f.location.href);this.trackEvent("page_load",c.info.pageviewInfo(a))};d.prototype.set_config=function(a){c.isObject(a)&&c.extend(this.config,a)};d.prototype.get_config=function(a){return this.config[a]};d.prototype.toString=function(){var a=this.get_config("name");"cooladata"!==a&&(a="cooladata."+a);return a};c.toArray=
c.toArray;c.isObject=c.isObject;c.JSONEncode=c.JSONEncode;c.info=c.info;d.prototype.init=d.prototype.init;d.prototype.track_event=d.prototype.trackEvent;d.prototype.track_event_later=d.prototype.trackEventLater;d.prototype.flush=d.prototype.flush;d.prototype.track_pageload=d.prototype.track_pageload;d.prototype.set_config=d.prototype.set_config;d.prototype.get_config=d.prototype.get_config;d.prototype.toString=d.prototype.toString;if(c.isUndefined(g))p.critical("'cooladata' object not initialized. Ensure you are using the latest version of the Cooladata JS Library along with the snippet we provide.");
else if(g.__loaded||g.config)k.log("Cooladata library has already been downloaded at least once.");else if(1.1>o)k.critical("Version mismatch; please ensure you're using the latest version of the Cooladata code snippet.");else{var n={};c.each(g._i,function(a){var b;a&&c.isArray(a)&&(b=a[a.length-1],a=s.apply(this,a),n[b]=a)});g.init=function(a,b,d){d?g[d]||(g[d]=n[d]=s(a,b,d),g[d]._loaded()):(d=g,n.cooladata?d=n.cooladata:a&&(d=s(a,b,"cooladata"),d._loaded()),window.cooladata=g=d,c.each(n,function(a,
b){"cooladata"!==b&&(g[b]=a)}),g._=c)};g.init();c.each(n,function(a){a._loaded()});if(f.addEventListener)"complete"==f.readyState?m():f.addEventListener("DOMContentLoaded",m,!1);else if(f.attachEvent){f.attachEvent("onreadystatechange",m);o=!1;try{o=null==window.frameElement}catch(I){}if(f.documentElement.doScroll&&o){var G=function(){try{f.documentElement.doScroll("left")}catch(a){setTimeout(G,1);return}m()};G()}}c.register_event(window,"load",m,!0)}})(window.cooladata);